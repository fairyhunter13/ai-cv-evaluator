worker_processes auto;

events {}

http {
  include       mime.types;
  default_type  application/octet-stream;
  sendfile      on;
  keepalive_timeout 65;

  # Use Docker embedded DNS to resolve service names (grafana, mailpit, etc.).
  resolver 127.0.0.11 ipv6=off valid=10s;

  # Rate limiting zones for SSO/login abuse prevention (production)
  # oauth2_login_zone: 10 requests/second per IP for login endpoints
  limit_req_zone $binary_remote_addr zone=oauth2_login_zone:10m rate=10r/s;
  # oauth2_callback_zone: 5 requests/second per IP for callback endpoints
  limit_req_zone $binary_remote_addr zone=oauth2_callback_zone:10m rate=5r/s;

  upstream app_upstream { server backend_blue:8080; }
  server_tokens off;
  client_max_body_size 20m;

  # Load site configs
  include /etc/nginx/conf.d/*.conf;
}
