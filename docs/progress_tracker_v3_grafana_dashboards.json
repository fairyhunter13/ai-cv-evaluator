{
  "$schema": "progress_tracker_v3.0",
  "metadata": {
    "project_name": "ai-cv-evaluator",
    "project_description": "AI CV Evaluator",
    "conversation_id": "grafana-dashboards-no-data-2025-12-16",
    "ticket_ids": [],
    "repository": "github.com/fairyhunter13/ai-cv-evaluator",
    "workspace": "/home/hafiz/go/src/github.com/fairyhunter13/ai-cv-evaluator",
    "owner": "",
    "created_at": "2025-12-16",
    "last_updated": "2025-12-16"
  },
  "references": {
    "retrieved_at": "2025-12-16",
    "items": []
  },
  "context": {
    "problem_statement": "Some Grafana dashboards (notably Docker Containers and AI Metrics) show 'No data' in production. Additionally, the repo still contains legacy IdP references even though Authelia is the active IdP.",
    "background": "Dashboards are provisioned from deploy/grafana/dashboards/*.json and use Prometheus as datasource. Prometheus scrapes app, worker, cadvisor, meta-exporter, and node-exporter. Docker dashboard joins cadvisor metrics to meta-exporter container_meta_info to display friendly compose service names.",
    "goals": [
      "Fix Grafana dashboards so key panels reliably show data in production",
      "Add/adjust Playwright E2E checks to validate dashboard panels have backing Prometheus data",
      "Audit and remove deprecated IdP references, keeping Authelia as the sole IdP"
    ],
    "non_goals": [
      "Redesign dashboards beyond fixing queries",
      "Introduce new auth provider"
    ],
    "constraints": [
      "Prefer minimal diffs",
      "Avoid flaky test assertions"
    ],
    "environments": [
      "local",
      "prod"
    ],
    "success_criteria": [
      "Docker Containers dashboard panels no longer show 'No data' due to ID join issues",
      "AI Metrics dashboard shows zeros (not 'No data') when there is no AI traffic",
      "Playwright suite validates Prometheus has data for key panels",
      "Deprecated IdP references are removed or clearly isolated to legacy/backup-only"
    ],
    "notes": ""
  },
  "requirements": {
    "status": "OPTIONAL",
    "forbidden": [],
    "required": [],
    "notes": ""
  },
  "overall_status": {
    "completion_percentage": 100,
    "status": "COMPLETED",
    "current_blocker": null,
    "risk_level": "LOW",
    "summary": "Fixed Docker Containers join regex, added Prometheus-backed Playwright checks, updated AI dashboard fallbacks, validated dashboards via Playwright, and removed deprecated IdP references from active paths."
  },
  "architecture": {
    "status": "NOT_STARTED",
    "concepts": [],
    "decisions": [],
    "artifacts": [],
    "reference_ids": [],
    "notes": ""
  },
  "performance": {
    "status": "NOT_STARTED",
    "standards": {
      "slo": "",
      "capacity": "",
      "notes": ""
    },
    "optimization_best_practices": [],
    "measurement": {
      "benchmarks": [],
      "profiling": [],
      "artifacts": [],
      "notes": ""
    },
    "reference_ids": [],
    "notes": ""
  },
  "security": {
    "status": "NOT_STARTED",
    "standards_reference_ids": [],
    "best_practices": [],
    "checks": {
      "threat_model": "NOT_STARTED",
      "code_review": "NOT_STARTED",
      "sast": "NOT_STARTED",
      "dependency_scan": "NOT_STARTED",
      "secrets_scan": "NOT_STARTED",
      "notes": ""
    },
    "reference_ids": [],
    "notes": ""
  },
  "safety": {
    "status": "NOT_STARTED",
    "standards": "",
    "checks": [],
    "reference_ids": [],
    "notes": ""
  },
  "tasks": [
    {
      "id": "TASK-0001",
      "title": "Create progress tracker for Grafana/IdP cleanup",
      "description": "Create repo-local Progress Tracker v3 document to track investigation, fixes, tests, and rollout readiness.",
      "category": "analysis",
      "priority": "HIGH",
      "status": "COMPLETED",
      "owner": "",
      "notes": "Created docs/progress_tracker_v3_grafana_dashboards.json",
      "links": [],
      "test_status": {
        "status": "NOT_APPLICABLE",
        "process": "",
        "commands": [],
        "expected_result": "",
        "actual_result": "",
        "evidence": [],
        "notes": ""
      },
      "validation_status": {
        "status": "NOT_STARTED",
        "process": "",
        "criteria": [],
        "evidence": [],
        "notes": ""
      },
      "issue_status": {
        "status": "NONE",
        "issue_summary": "",
        "impact": "",
        "root_cause": "",
        "how_to_solve": "",
        "notes": ""
      },
      "investigation_status": {
        "status": "COMPLETED",
        "process": "",
        "hypotheses": [
          "Docker dashboard uses cadvisor id label format that differs across hosts (systemd cgroup v2 vs docker cgroup v1), breaking join to meta-exporter"
        ],
        "findings": [
          "Docker dashboard joins cadvisor -> meta-exporter using label_replace on cadvisor 'id' with regex '.*/docker-([a-f0-9]{12}).*' which does not match '/docker/<id>' paths"
        ],
        "time_spent": "",
        "notes": ""
      },
      "research_status": {
        "status": "NOT_STARTED",
        "questions": [],
        "notes": "",
        "how_to": "",
        "reference_ids": []
      }
    },
    {
      "id": "TASK-0002",
      "title": "Fix Docker Containers dashboard PromQL joins",
      "description": "Update docker_containers.json PromQL to robustly extract container IDs across cadvisor id formats and restore friendly-name joins.",
      "category": "implementation",
      "priority": "HIGH",
      "status": "COMPLETED",
      "owner": "",
      "notes": "Updated container id extraction regex from docker-<id> to docker[-/]<id> to support both cgroup path formats.",
      "links": [],
      "test_status": {
        "status": "NOT_STARTED",
        "process": "",
        "commands": [],
        "expected_result": "",
        "actual_result": "",
        "evidence": [],
        "notes": ""
      },
      "validation_status": {
        "status": "NOT_STARTED",
        "process": "",
        "criteria": [],
        "evidence": [],
        "notes": ""
      },
      "issue_status": {
        "status": "NONE",
        "issue_summary": "",
        "impact": "",
        "root_cause": "",
        "how_to_solve": "",
        "notes": ""
      },
      "investigation_status": {
        "status": "IN_PROGRESS",
        "process": "",
        "hypotheses": [],
        "findings": [],
        "time_spent": "",
        "notes": ""
      },
      "research_status": {
        "status": "NOT_STARTED",
        "questions": [],
        "notes": "",
        "how_to": "",
        "reference_ids": []
      }
    },
    {
      "id": "TASK-0003",
      "title": "Fix AI dashboard to avoid 'No data' when idle",
      "description": "Update ai-metrics.json PromQL with safe fallbacks so idle environments show zeros instead of 'No data'.",
      "category": "implementation",
      "priority": "MEDIUM",
      "status": "COMPLETED",
      "owner": "",
      "notes": "Added fallbacks (or on() vector(0)) to multi-series AI panels and percentile panels to reduce 'No data' in idle environments.",
      "links": [],
      "test_status": {
        "status": "NOT_STARTED",
        "process": "",
        "commands": [],
        "expected_result": "",
        "actual_result": "",
        "evidence": [],
        "notes": ""
      },
      "validation_status": {
        "status": "NOT_STARTED",
        "process": "",
        "criteria": [],
        "evidence": [],
        "notes": ""
      },
      "issue_status": {
        "status": "OPEN",
        "issue_summary": "AI Metrics dashboard shows 'No data' if no evaluations ran",
        "impact": "Operators misinterpret this as monitoring broken",
        "root_cause": "Prometheus CounterVec/HistogramVec do not emit series until observed; quantile panels return empty vectors",
        "how_to_solve": "Use PromQL fallbacks (or on() vector(0)) for key panels",
        "notes": ""
      },
      "investigation_status": {
        "status": "NOT_STARTED",
        "process": "",
        "hypotheses": [],
        "findings": [],
        "time_spent": "",
        "notes": ""
      },
      "research_status": {
        "status": "NOT_STARTED",
        "questions": [],
        "notes": "",
        "how_to": "",
        "reference_ids": []
      }
    },
    {
      "id": "TASK-0004",
      "title": "Add/adjust Playwright checks for dashboard data",
      "description": "Add API-based Prometheus checks for docker + AI metrics so E2E fails when monitoring is broken (not just when UI loads).",
      "category": "testing",
      "priority": "MEDIUM",
      "status": "COMPLETED",
      "owner": "",
      "notes": "Added Prometheus datasource proxy assertions for docker-monitoring and ai-metrics dashboards.",
      "links": [],
      "test_status": {
        "status": "NOT_STARTED",
        "process": "",
        "commands": [],
        "expected_result": "",
        "actual_result": "",
        "evidence": [],
        "notes": ""
      },
      "validation_status": {
        "status": "NOT_STARTED",
        "process": "",
        "criteria": [],
        "evidence": [],
        "notes": ""
      },
      "issue_status": {
        "status": "OPEN",
        "issue_summary": "Playwright currently mostly checks for UI 'No data' text; doesn't assert Prometheus series exist for Docker panels",
        "impact": "Monitoring regressions can slip through",
        "root_cause": "Missing direct Prometheus queries for Docker metrics",
        "how_to_solve": "Query Prometheus via Grafana datasource proxy for expected metrics (cadvisor + meta-exporter + ai_*)",
        "notes": ""
      },
      "investigation_status": {
        "status": "NOT_STARTED",
        "process": "",
        "hypotheses": [],
        "findings": [],
        "time_spent": "",
        "notes": ""
      },
      "research_status": {
        "status": "NOT_STARTED",
        "questions": [],
        "notes": "",
        "how_to": "",
        "reference_ids": []
      }
    },
    {
      "id": "TASK-0005",
      "title": "Audit/remove deprecated IdP references",
      "description": "Remove stale IdP references in docs/tests/nginx configs; confirm prod uses Authelia only.",
      "category": "cleanup",
      "priority": "LOW",
      "status": "COMPLETED",
      "owner": "",
      "notes": "Removed deprecated IdP references from Playwright tests, dev nginx config, docs, and Terraform. Legacy artifacts were moved under backup/.",
      "links": [],
      "test_status": {
        "status": "NOT_STARTED",
        "process": "",
        "commands": [],
        "expected_result": "",
        "actual_result": "",
        "evidence": [],
        "notes": ""
      },
      "validation_status": {
        "status": "NOT_STARTED",
        "process": "",
        "criteria": [],
        "evidence": [],
        "notes": ""
      },
      "issue_status": {
        "status": "OPEN",
        "issue_summary": "Repo still contains some legacy IdP artifacts and wording (primarily docs/progress notes and legacy templates)",
        "impact": "Confusion and accidental reliance on deprecated IdP",
        "root_cause": "Legacy config and documentation not cleaned up after migration to Authelia",
        "how_to_solve": "Update docs to mention Authelia, remove unused nginx/test references, and either delete or clearly mark any legacy IdP artifacts",
        "notes": ""
      },
      "investigation_status": {
        "status": "NOT_STARTED",
        "process": "",
        "hypotheses": [],
        "findings": [],
        "time_spent": "",
        "notes": ""
      },
      "research_status": {
        "status": "NOT_STARTED",
        "questions": [],
        "notes": "",
        "how_to": "",
        "reference_ids": []
      }
    }
  ],
  "test_summary": {
    "total_tests": 1,
    "unit_tests": 0,
    "integration_tests": 0,
    "e2e_tests": 1,
    "manual_tests": 0,
    "passed": 1,
    "failed": 0,
    "blocked": 0,
    "test_coverage": "",
    "prod_scenario_replicated": false,
    "fix_validated": true,
    "notes": "Validated dashboards via Playwright (portal-dashboards) against local dev stack."
  },
  "local_execution_status": {
    "services": [],
    "notes": ""
  },
  "validation_summary": {
    "core_validation_status": "COMPLETED",
    "summary": "Playwright validated that dashboards load and Prometheus-backed queries return results (including Docker join and AI metrics fallbacks).",
    "evidence": [
      "admin-frontend: E2E_BASE_URL=http://localhost:8088 npx playwright test tests/sso-gate.spec.ts -g \"dashboards reachable via portal after SSO login\""
    ],
    "notes": ""
  },
  "issues_summary": [],
  "changelog": [
    {
      "date": "2025-12-16",
      "changes": [
        "Created tracker docs/progress_tracker_v3_grafana_dashboards.json",
        "Identified likely Docker dashboard root cause: cadvisor container id regex only matches docker-<id> and fails for docker/<id> formats",
        "Updated Docker Containers dashboard PromQL to use docker[-/]<id> extraction for robust joins",
        "Updated AI Metrics dashboard PromQL to add fallbacks for idle environments",
        "Added Playwright Prometheus-backed assertions for Docker + AI dashboards",
        "Removed legacy IdP-specific logic from Playwright SSO helpers/specs and updated docs to reference Authelia"
      ]
    }
  ]
}
